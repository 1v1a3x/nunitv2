<?xml version="1.0"?>
<project name="NUnit.Tests" default="build">

    <!--
        Required properties:
            * bin.dir               - bin directory
            * src.dir               - source location(build) or target(copy)
            * build.debug           - (true|false) debug build?
            * build.mono            - (true|false) mono build?
            * build.defines.csc     - build defines for build config
    -->

    <target name="build" depends="copy">

        <!-- Build assemblies used by the tests -->
        <nant buildfile="mock-assembly/mock-assembly.build" target="build"/>
        <nant buildfile="nonamespace-assembly/nonamespace-assembly.build" target="build"/>
        <nant buildfile="notestfixtures-assembly/notestfixtures-assembly.build" target="build"/>

        <!-- Build nunit.tests.dll - the main test assembly -->
        <csc target="library" output="${bin.dir}/nunit.tests.dll" debug="${build.debug}" define="${build.defines.csc},NANTBUILD">
            <sources basedir="${src.dir}/tests">
                <include name="*.cs"/>
            </sources>
            <references basedir="${bin.dir}">
                <include name="nunit.uikit.dll" unless="${build.mono}"/>
                <include name="nunit.util.dll"/>
                <include name="nunit.extensions.dll"/>
                <include name="nunit.core.dll"/>
                <include name="nunit.framework.dll"/>
                <include name="nunit.mocks.dll"/>
                <include name="mock-assembly.dll"/>
                <include name="nonamespace-assembly.dll"/>
                <include name="notestfixtures-assembly.dll"/>
            </references>
        </csc>

        <copy file="${src.dir}/tests/nunit.tests.dll.config" todir="${bin.dir}"/>

        <!-- Build timing-tests.dll -->
        <nant buildfile="timing-tests/timing-tests.build" target="build"/>
    </target>

    <target name="copy">
        <copy todir="${src.dir}/tests">
            <fileset basedir=".">
                <include name="nunit.tests.dll.csproj"/>
                <include name="nunit.tests.dll.config"/>
                <include name="tests.build"/>
                <include name="*.cs"/>

                <exclude name="AddConfigurationDialogTests.cs" if="${build.mono}"/>
	        <exclude name="ProgressBarTests.cs" if="${build.mono}"/>
		<exclude name="RecentFileMenuHandlerTests.cs" if="${build.mono}"/>
		<exclude name="StatusBarTests.cs" if="${build.mono}"/>
		<exclude name="TestSuiteTreeNodeTests.cs" if="${build.mono}"/>
		<exclude name="TestSuiteTreeViewFixture.cs" if="${build.mono}"/>
                <exclude name="FormSettingsTests.cs" if="${build.mono}"/>
		<exclude name="TestLoaderAssemblyTests.cs" if="${build.mono}"/>
		<exclude name="TextBoxWriterTests.cs" if="${build.mono}"/>
                <exclude name="UserSettingsTests.cs" if="${build.mono}"/>
                <exclude name="NUnitRegistryTests.cs" if="${build.mono}"/>
                <exclude name="OptionSettingsTests.cs" if="${build.mono}"/>
                <exclude name="RegistrySettingsStorageTests.cs" if="${build.mono}"/>
                <exclude name="RecentProjectsFixture.cs" if="${build.mono}"/>
                <exclude name="SettingsGroupTests.cs" if="${build.mono}"/>
            </fileset>
        </copy>
    </target>

    <target name="copy-all" depends="copy">
        <nant buildfile="mock-assembly/mock-assembly.build" target="copy"/>
        <nant buildfile="nonamespace-assembly/nonamespace-assembly.build" target="copy"/>
        <nant buildfile="notestfixtures-assembly/notestfixtures-assembly.build" target="copy"/>
        <nant buildfile="timing-tests/timing-tests.build" target="copy"/>
    </target>
</project>
